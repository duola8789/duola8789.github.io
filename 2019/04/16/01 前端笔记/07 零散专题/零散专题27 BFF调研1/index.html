<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo-new.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"duola8789.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="BFF调研报告。">
<meta property="og:type" content="article">
<meta property="og:title" content="零散专题27 BFF调研1">
<meta property="og:url" content="https://duola8789.github.io/2019/04/16/01%20%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/07%20%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%98/%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%9827%20BFF%E8%B0%83%E7%A0%941/index.html">
<meta property="og:site_name" content="不负时光">
<meta property="og:description" content="BFF调研报告。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://image.oldzhou.cn/v2-50720e139878624f394dcf2d3de836fb_hd.jpg">
<meta property="og:image" content="http://image.oldzhou.cn/service4.png">
<meta property="og:image" content="http://image.oldzhou.cn/service5.png">
<meta property="og:image" content="http://image.oldzhou.cn/service.png">
<meta property="og:image" content="http://image.oldzhou.cn/serveice2.png">
<meta property="og:image" content="http://image.oldzhou.cn/service3.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-11.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-1.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-2.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-3.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF10.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-5.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-6.png">
<meta property="og:image" content="http://image.oldzhou.cn/BFF-7.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA2.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA3.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA%E7%BD%91%E5%85%B31.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA%E7%BD%91%E5%85%B32.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA-4.png">
<meta property="og:image" content="http://image.oldzhou.cn/Basement.png">
<meta property="og:image" content="http://image.oldzhou.cn/TWA-6.png">
<meta property="og:image" content="http://image.oldzhou.cn/youzan1.png">
<meta property="og:image" content="http://image.oldzhou.cn/youzan2.png">
<meta property="article:published_time" content="2019-04-16T06:02:51.000Z">
<meta property="article:modified_time" content="2019-04-28T07:38:41.000Z">
<meta property="article:author" content="多啦大薯片">
<meta property="article:tag" content="BFF">
<meta property="article:tag" content="TWA">
<meta property="article:tag" content="微服务">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://image.oldzhou.cn/v2-50720e139878624f394dcf2d3de836fb_hd.jpg">


<link rel="canonical" href="https://duola8789.github.io/2019/04/16/01%20%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/07%20%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%98/%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%9827%20BFF%E8%B0%83%E7%A0%941/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://duola8789.github.io/2019/04/16/01%20%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/07%20%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%98/%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%9827%20BFF%E8%B0%83%E7%A0%941/","path":"2019/04/16/01 前端笔记/07 零散专题/零散专题27 BFF调研1/","title":"零散专题27 BFF调研1"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>零散专题27 BFF调研1 | 不负时光</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?383801e819a170224708308b7b4411a5"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">不负时光</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">少年回头望，笑我还不快跟上</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="http://www.oldzhou.cn/pages/page1.html" rel="section" target="_blank"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E4%B8%AD%E5%AD%98%E5%9C%A8%E7%9A%84%E9%9A%BE%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">前端开发中存在的难问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BFF"><span class="nav-number">2.</span> <span class="nav-text">BFF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BFF%E7%9A%84%E6%BC%94%E5%8C%96%E5%8E%86%E7%A8%8B"><span class="nav-number">3.</span> <span class="nav-text">BFF的演化历程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9E%B6%E6%9E%84V1"><span class="nav-number">3.1.</span> <span class="nav-text">服务化架构V1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9E%B6%E6%9E%84V2"><span class="nav-number">3.2.</span> <span class="nav-text">服务化架构V2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8C%96%E6%9E%B6%E6%9E%84V2-1"><span class="nav-number">3.3.</span> <span class="nav-text">服务化架构V2.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84V3"><span class="nav-number">3.4.</span> <span class="nav-text">微服务架构V3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84V4"><span class="nav-number">3.5.</span> <span class="nav-text">微服务架构V4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.</span> <span class="nav-text">具体实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%86%E5%88%86%E5%8A%9B%E5%BA%A6"><span class="nav-number">4.1.</span> <span class="nav-text">细分力度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%8E%A5%E4%B8%8B%E6%B8%B8%E6%9C%8D%E5%8A%A1%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="nav-number">4.2.</span> <span class="nav-text">对接下游服务（微服务）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E7%94%A8%E9%97%AE%E9%A2%98"><span class="nav-number">4.3.</span> <span class="nav-text">复用问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%9A%82%E8%9A%81%E8%B4%A2%E5%AF%8C%E7%9A%84BFF%E5%AE%9E%E8%B7%B5"><span class="nav-number">5.</span> <span class="nav-text">蚂蚁财富的BFF实践</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TWA%E7%9A%84%E7%90%86%E5%BF%B5%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="nav-number">6.</span> <span class="nav-text">TWA的理念与实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6"><span class="nav-number">6.1.</span> <span class="nav-text">框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A0%94%E5%8F%91%E5%B9%B3%E5%8F%B0"><span class="nav-number">6.2.</span> <span class="nav-text">研发平台</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Node%E4%B8%8EJava%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="nav-number">7.</span> <span class="nav-text">Node与Java的通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%9A%82%E8%9A%81%E9%87%91%E6%9C%8D%E7%9A%84%E5%AE%9E%E8%B7%B5"><span class="nav-number">7.1.</span> <span class="nav-text">蚂蚁金服的实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E8%B5%9E%E7%9A%84%E5%AE%9E%E8%B7%B5-%E2%80%93-HTTP"><span class="nav-number">7.2.</span> <span class="nav-text">有赞的实践 – HTTP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8ETWA"><span class="nav-number">8.1.</span> <span class="nav-text">关于TWA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%85%A5BFF%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="nav-number">8.2.</span> <span class="nav-text">接入BFF的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%85%A5BFF%E7%9A%84%E5%9D%8F%E5%A4%84%EF%BC%9A"><span class="nav-number">8.3.</span> <span class="nav-text">接入BFF的坏处：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%92%8C%E5%8F%AF%E8%83%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="nav-number">8.4.</span> <span class="nav-text">可能遇到的问题和可能的解决方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="多啦大薯片"
      src="/images/avatar3.png">
  <p class="site-author-name" itemprop="name">多啦大薯片</p>
  <div class="site-description" itemprop="description">欲买桂花同载酒，终不似，少年游</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">214</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">283</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/duola8789" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;duola8789" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:duola8789@126.com" title="E-Mail → mailto:duola8789@126.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://duola8789.github.io/2019/04/16/01%20%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/07%20%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%98/%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%9827%20BFF%E8%B0%83%E7%A0%941/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar3.png">
      <meta itemprop="name" content="多啦大薯片">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="不负时光">
      <meta itemprop="description" content="欲买桂花同载酒，终不似，少年游">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="零散专题27 BFF调研1 | 不负时光">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          零散专题27 BFF调研1
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-16 14:02:51" itemprop="dateCreated datePublished" datetime="2019-04-16T14:02:51+08:00">2019-04-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-04-28 15:38:41" itemprop="dateModified" datetime="2019-04-28T15:38:41+08:00">2019-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>BFF调研报告。</p>
<span id="more"></span>

<h2 id="前端开发中存在的难问题"><a href="#前端开发中存在的难问题" class="headerlink" title="前端开发中存在的难问题"></a>前端开发中存在的难问题</h2><ol>
<li>多端应用，不同类型客户端对数据、API有个性化的需求</li>
<li>服务聚合，单一后端为多个前端团队提供接口，导致跨团队协作低效，资源协调困难</li>
</ol>
<p>问题：<strong>服务端设计的接口究竟是面向UI，还是面向通用服务</strong>？</p>
<h2 id="BFF"><a href="#BFF" class="headerlink" title="BFF"></a>BFF</h2><p>解决方案： Backends For Frontends， 简称BFF。</p>
<p>BFF最适合的场景，为第三方提供定制API等差异化场景，每个用户体验（客户端）对应一个后端，</p>
<p><img src="http://image.oldzhou.cn/v2-50720e139878624f394dcf2d3de836fb_hd.jpg" alt="v2-50720e139878624f394dcf2d3de836fb_hd.jpg"></p>
<p>BFF作为用户体验适配层，对后端接口进行组合、处理，对数据进行：裁剪、格式化、聚合、编排。</p>
<p>BFF理念中，最重要的一点是：服务自治，谁使用谁开发，所以一般由前端维护。</p>
<p>BFF实现不限制具体技术，可以自由选型：Java&#x2F;Node&#x2F;PHP&#x2F;Python，但大部分前端团队都会选择Node.js。</p>
<h2 id="BFF的演化历程"><a href="#BFF的演化历程" class="headerlink" title="BFF的演化历程"></a>BFF的演化历程</h2><p>BFF和网关（API Gateway）是微服务架构中两个重要概念，可以通过下面的例子讲解BFF的出现过程</p>
<h3 id="服务化架构V1"><a href="#服务化架构V1" class="headerlink" title="服务化架构V1"></a>服务化架构V1</h3><p>实现单块应用的解构拆分，微服务初步完成，前端用户体验层主要是传统的服务端Web应用，服务化架构如下所示：</p>
<p><img src="http://image.oldzhou.cn/service4.png" alt="service4.png"></p>
<h3 id="服务化架构V2"><a href="#服务化架构V2" class="headerlink" title="服务化架构V2"></a>服务化架构V2</h3><p>随着无线应用的流行，除了Web应用外，服务还需要为新的无线原生App来提供接口和数据，先采用下面的服务架构：</p>
<p><img src="http://image.oldzhou.cn/service5.png" alt="service5.png"></p>
<p>这样的架构的问题是：</p>
<ol>
<li>无线App与内部为微服务强耦合</li>
<li>无线App需要知道内部服务的地址等细节</li>
<li>无线App需要对接口数据进行大量的聚合剪裁和适配逻辑</li>
</ol>
<h3 id="服务化架构V2-1"><a href="#服务化架构V2-1" class="headerlink" title="服务化架构V2.1"></a>服务化架构V2.1</h3><p>为了解决这个问题，在用户体验层和内部微服务层之间引入了BFF层，将后端的微服务进行适配，想用户体验层暴露有号和统一的API，方便无线设备接入访问后端服务</p>
<p><img src="http://image.oldzhou.cn/service.png" alt="service.png"></p>
<p>这种架构解决了上面的问题：</p>
<ol>
<li>无线App与内部为微服务解耦，两边可以独立变化</li>
<li>无线App只需要知道BFF的地址，并且服务接口统一，不需要关心内部复杂的微服务的地址和细节</li>
<li>无线App需要不再需要聚合剪裁和适配逻辑，这些步骤都在BFF完成</li>
</ol>
<p>但是随着接入设备的增加，也会有一些问题：</p>
<ol>
<li>BFF只有一个，接入设备增加后导致要考虑匹配问题，团队之间沟通协调成本高</li>
<li>BFF中不仅包括了各个业务线的聚合剪裁、适配和业务逻辑，还需要引入很多跨横切面逻辑，比如安全认证、日志监控、限流熔断等，这些代码混在一起，导致代码复杂度提高</li>
<li>BFF如果出现错误，会导致所有应用都不可用</li>
</ol>
<h3 id="微服务架构V3"><a href="#微服务架构V3" class="headerlink" title="微服务架构V3"></a>微服务架构V3</h3><p>为了解决这个问题，引入API Gateway</p>
<p><img src="http://image.oldzhou.cn/serveice2.png" alt="serveice2.png"></p>
<p>在这种架构下：</p>
<ol>
<li>BFF按团队和业务线进行解耦拆分，拆分成若干个BFF微服务，每个业务线并行开发和交付各自负责的BFF微服务</li>
<li>网关，一般由独立的团队负责运维，专注跨横切面的功能，包括  <ul>
<li>路由，将来自无线设备的请求路由到后端的某个微服务BFF集群</li>
<li>认证，对涉及敏感数据的API访问进行集中认证鉴权</li>
<li>监控，对API调用进行性能监控</li>
<li>限流熔断，网关能够进行限流熔断，保护后端服务</li>
<li>安全防爬，收集访问日志，通过后台分析恶意行为，阻断恶意请求</li>
</ul>
</li>
<li>网关在客户端与BFF之间又引入了一层，让两边可以独立变化</li>
</ol>
<h3 id="微服务架构V4"><a href="#微服务架构V4" class="headerlink" title="微服务架构V4"></a>微服务架构V4</h3><p>可以对V3架构进行优化，将传统的服务端Web应用模式改为前后分离架构，前端采用H5单页技术提供给用户更好体验。</p>
<p>同时增加了下手是哪个第三方应用开放API的能力</p>
<p><img src="http://image.oldzhou.cn/service3.png" alt="service3.png"></p>
<p>拓展新的接入渠道，形成了一个完成的现代微服务架构，从外到内依次为：<strong>端用户体验层-&gt;网关层-&gt;BFF层-&gt;微服务层</strong></p>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="细分力度"><a href="#细分力度" class="headerlink" title="细分力度"></a>细分力度</h3><p>要求把一个大后端拆分为多个小后端，有三种方式</p>
<ul>
<li>用户体验级（UI）</li>
<li>端级</li>
<li>团队级</li>
</ul>
<p>一般建议按照用户体验级来拆分</p>
<h3 id="对接下游服务（微服务）"><a href="#对接下游服务（微服务）" class="headerlink" title="对接下游服务（微服务）"></a>对接下游服务（微服务）</h3><p>（1）如何对接多个技术栈不同的下游服务</p>
<p>RPC协议调用</p>
<p>（2）如何管理、组合调用</p>
<p>借助RXJava、Finagle等事件机制来简化这些异步流程控制</p>
<p>（3）某个调用失败时，如何保障可用性</p>
<p>在BFF层容错，同时前端保证可接受不完整相应内容</p>
<h3 id="复用问题"><a href="#复用问题" class="headerlink" title="复用问题"></a>复用问题</h3><p>拆分后，多个BFF间会产生冗余代码，这是不可避免的。</p>
<p>可以添加API网关层，将通用的后端逻辑（授权、认证、限流）放进去</p>
<p>想消除冗余，又不想因为抽离可复用代码而导致BFF间紧耦合，所以就有了一种折衷的态度：<strong>容忍BFF间冗余、消除单BFF内冗余</strong>。也就是允许一定程度的BFF间冗余</p>
<h2 id="蚂蚁财富的BFF实践"><a href="#蚂蚁财富的BFF实践" class="headerlink" title="蚂蚁财富的BFF实践"></a>蚂蚁财富的BFF实践</h2><p>2016年时，<a target="_blank" rel="noopener" href="https://github.com/coolme200">汤尧</a>对BFF在蚂蚁财富项目中的落地实践进行了介绍。</p>
<p>在引入BFF之前，蚂蚁财富的业务也遇到了上面提到的问题，主要是体验层API经常变化，导致开发效率低下。</p>
<p>于是引入了BFF，主要的目的是对数据进行：裁剪、格式化、聚合、编排。</p>
<p>一个理想的模型如下：</p>
<p><img src="http://image.oldzhou.cn/BFF-11.png" alt="BFF-11.png"></p>
<p>在实际落地过程中，形成了如下的架构：</p>
<p><img src="http://image.oldzhou.cn/BFF-1.png" alt="BFF-1.png"></p>
<p>他们在实战过程中，主要解决了一下几个问题：</p>
<p>（1）Node.js与Java通信</p>
<ul>
<li>数据：跨语言序列化协议hessian</li>
<li>服务：Node弱类型，Java强类型，如何调用</li>
</ul>
<p><img src="http://image.oldzhou.cn/BFF-2.png" alt="BFF-2.png"></p>
<p>这个调用过程一般是通过RPC协议完成的，而非通过HTTP协议。</p>
<p>由于我对Java没有接触，而且资料只是他当时的PPT，没有详细的讲解，没有办法理解具体是如何实现的。而且恐怕对于大多数前端开发工程师来说，与Java的通信也是BFF落地过程中一个比较严峻的挑战，而且这是在前端开发人员有比较好的Node开发能力的基础上。</p>
<p>（2）多App适配</p>
<p>在API网关层处理多个App的通用的逻辑，比如错误码管理、数据一致性、免登、业务日志等。</p>
<p>（3）聚合</p>
<p><img src="http://image.oldzhou.cn/BFF-3.png" alt="BFF-3.png"></p>
<ul>
<li>传给客户端需要的数据，简化客户端逻辑，减少网络开销</li>
<li>避免无意义的透传</li>
<li>敏感信息过滤</li>
</ul>
<p>（4）接口设计准则</p>
<p>基础服务接口：（微服务？）</p>
<ul>
<li>细粒度</li>
<li>通用的功能，可能会被多个BFF用到</li>
<li>提供含各种状态的mock真实数据，易于同步开发（如何实现？）</li>
</ul>
<p>BFF API设计</p>
<ul>
<li>合理设计接口数量，太多不易维护</li>
<li>提供含各种状态的mock真实数据，页面不依赖server开发（如何实现？）</li>
<li>多协议发布（如何实现？）</li>
<li>规范数据格式</li>
</ul>
<p>在落地BFF过程中，从技术角度来看：</p>
<ul>
<li>前端和BFF由同一人完成</li>
<li>前端需要具备服务端技能</li>
<li>快速的应用发布能力（docker？）</li>
</ul>
<h2 id="TWA的理念与实践"><a href="#TWA的理念与实践" class="headerlink" title="TWA的理念与实践"></a>TWA的理念与实践</h2><p>在2018年的SEE Conf，蚂蚁金服的不四（<a target="_blank" rel="noopener" href="https://www.zhihu.com/people/dead_horse/activities">知乎ID：死马</a>)对在BFF基础上发展出来的TWA（Techless Web Application）开发体系进行了介绍（<a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XMzMwMzc2NDg0OA==.html">视频</a>和<a target="_blank" rel="noopener" href="https://www.yuque.com/office/yuque/2018/pdf/546dea6e-66dd-4cf5-98fb-7c2476ea4986.pdf">PPT</a>）。</p>
<p>传统的分层：</p>
<p><img src="http://image.oldzhou.cn/BFF10.png" alt="BFF10.png"></p>
<p>BFF负责聚合底层业务数据，给客户端提供接口，秉承谁使用谁维护的理念，一般由前端团队维护。</p>
<p><img src="http://image.oldzhou.cn/BFF-5.png" alt="v2-d245bbeae2b0245da8858bd237b344f7_r.jpg"></p>
<p>业务实际上分为三层：前端（HTML&#x2F;CSS&#x2F;JS）+ BFF（Node.js接口聚合层）+ 后端服务（Java）</p>
<p><img src="http://image.oldzhou.cn/BFF-6.png" alt="BFF-6.png"></p>
<p><code>BFF on Chari</code>是蚂蚁自研的，基于<a target="_blank" rel="noopener" href="https://eggjs.org/zh-cn/intro/">Egg.js</a>的BFF框架，打通了Node到Java的RPC通信链路</p>
<p>Egg.js已经开源（Egg.js是以Koa作为基础框架），需要基于Egg.js去打造属于自己的BFF框架</p>
<blockquote>
<p>RPC的意思是不在一个内存空间的两个应用，借助网络来实现，像调用本地的函数一样去调用远程函数</p>
</blockquote>
<p>BFF不是银弹，有着自己的问题：</p>
<p><img src="http://image.oldzhou.cn/BFF-7.png" alt="BFF-7.png"></p>
<ul>
<li>研发成本上升：前端团队既要开发客户端，又要开发BFF，人手不够</li>
<li>流程繁琐：BFF引入后，要同时走前端、服务端的研发流程，多端发布、互相依赖，导致流程繁琐</li>
<li>运维经验不足：主要是前端工程师运维经验不足（给业务团队带来了很大困扰）</li>
</ul>
<p>尽管职责划分越来越清晰，但是由于前后端发布系统不一致，前端团队仍需要在基于不同的代码仓库进行研发，走不同的发布流程</p>
<p>理想的开发流程：</p>
<p><img src="http://image.oldzhou.cn/TWA.png" alt="TWA.png"></p>
<p>蚂蚁金服推出的解决方案TWA（Techless Web Application），是一个全栈的研发框架</p>
<p>TWA是为了提升开发者研发体验而推出的渐进式解决方案，开发者在一个代码仓库下，基于TWA的框架，完成客户端和BFF层的研发，通过Basement研发平台提供的流程支持，不用再关注应用、构建、部署、流程等细节，可以一键将应用部署到各个运行终端，同时在研发平台上完成应用的自主运维和监控</p>
<p>将TWA拆解开来，分为了三个大的方向：框架、研发平台、运行时</p>
<ul>
<li>框架：提供了前后端合一的框架，通过定制化网关，抹平多个终端和接入形式的差异，让一套代码可以运行在不同的终端下（？)</li>
<li>研发平台：Basement，提供TWA的研发迭代、自主运维和监控，精简规范了H5 APP的研发流程</li>
<li>运行时：通过基础服务和Docker，给客户端代码和服务端代码提供稳定可靠的运行环境</li>
</ul>
<p><img src="http://image.oldzhou.cn/TWA2.png" alt="TWA2.png"></p>
<h3 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h3><p>是一个渐进式框架，可以选择部分能力使用</p>
<p><img src="http://image.oldzhou.cn/TWA3.png" alt="TWA3.png"></p>
<p>客户端、服务端目录、依赖都是相互独立的。</p>
<p>复杂的终端环境，有不同的接入链路（可能通过网关走TCP长连接通信）、不同的鉴权方案。如果每个业务的BFF系统要对接到每个系统完成接入、鉴权是非常复杂的。</p>
<p><img src="http://image.oldzhou.cn/TWA%E7%BD%91%E5%85%B31.png" alt="TWA网关2.png"></p>
<p>解决方案是：TWA网关层 + 客户端RPC Client，</p>
<p><img src="http://image.oldzhou.cn/TWA%E7%BD%91%E5%85%B32.png" alt="TWA网关2.png"></p>
<p>TWA网关层统一完成所有终端的接入、鉴权，BFF不需要对接到每个终端，只需要对接到网关，让BFF接口统一</p>
<p>客户端的RPC Clinet是一个请求库，对接到网关，将客户端的鉴权、接入的细节隐藏，并且可以自动选择接入链路</p>
<p>这就可以在client目录下，像调用本地方法一样，调用server中目录下的服务</p>
<p><img src="http://image.oldzhou.cn/TWA-4.png" alt="TWA-4.png"></p>
<h3 id="研发平台"><a href="#研发平台" class="headerlink" title="研发平台"></a>研发平台</h3><p><img src="http://image.oldzhou.cn/Basement.png" alt="Basement.png"></p>
<p>Basement，一站式运维平台，基于Docker，支撑整个应用的研发流程，完成自动化的测试和部署</p>
<p><img src="http://image.oldzhou.cn/TWA-6.png" alt="TWA-6.png"></p>
<h2 id="Node与Java的通信"><a href="#Node与Java的通信" class="headerlink" title="Node与Java的通信"></a>Node与Java的通信</h2><p>与使用的微服务框架有关，可以采用HTTP的方式，也可以通过RPC调用。</p>
<h3 id="蚂蚁金服的实践"><a href="#蚂蚁金服的实践" class="headerlink" title="蚂蚁金服的实践"></a>蚂蚁金服的实践</h3><ul>
<li>数据：跨语言序列化协议hessian</li>
<li>服务：Node PRC</li>
</ul>
<p>开源框架：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/alipay/sofa-bolt-node">sofa-bolt-node</a>：蚂蚁通讯协议Bolt的Nodejs实现</li>
<li><a target="_blank" rel="noopener" href="https://github.com/alipay/sofa-rpc-node/">sofa-rpc-node</a>：一个通用的Nodejs RPC模块</li>
</ol>
<h3 id="有赞的实践-–-HTTP"><a href="#有赞的实践-–-HTTP" class="headerlink" title="有赞的实践 – HTTP"></a>有赞的实践 – HTTP</h3><p>可以采用服务注册中心：</p>
<p><img src="http://image.oldzhou.cn/youzan1.png" alt="youzan1.png"></p>
<p>首先，Java应用服务启动的时候，会往服务注册中心注册服务，这里的服务注册中心可能是ETCD或者Zookeeper，然后，Node应用在启动的时候，会先从服务注册中心拉取服务列表，接着Node会跟Java服务建立一条TCP长链接，除此之外，Node还需要负责Hession协议解析以及负载均衡等。</p>
<p>上面的方式Node职责比较重，对Node开发的要求高，有赞在此基础上做了改进：</p>
<p><img src="http://image.oldzhou.cn/youzan2.png" alt="youzan2.png"></p>
<p>在Node和Java之间添加了一层中间代理层Tether，Tether是用Go语言写的一个本地代理，Tether会对外暴露一个HTTP的服务，对Node来说，只需要通过HTTP方式调用本地的服务即可，其他服务化相关的服务发现、协议解析、负载均衡、长链建立维护都交由Tether来处理。这样，Node这一层就非常轻量了，Node是调用Java服务时：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Service</span> = <span class="built_in">require</span>(<span class="string">&#x27;../base/BaseService&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Service</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据商品 alias 获取商品详情</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span>  &#123;<span class="type">String</span>&#125; alias 商品 alias</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getGoodsDetailByAlias</span>(<span class="params">alias</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">invoke</span>(</span><br><span class="line">      <span class="string">&#x27;com.youzan.ic.service.GoodsService&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;getGoodsDetailByAlias&#x27;</span>,</span><br><span class="line">      [alias]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">GoodsService</span>;</span><br></pre></td></tr></table></figure>

<p>这种方式的优点：</p>
<ol>
<li>使用简单，对前端开发非常友好，只需要通过HTTP方式调用本地的Tether服务即可；</li>
<li>多语言接入成本低，后期如果有其他语言（Python、Ruby）也需要接入整个服务化体系，也像Node一样，它们都只需要调用本地Tether暴露的HTTP服务即可，没有额外的开发成本了。</li>
<li>后期更方便做协议层的优化，因为这种方式Tether其实就是一个代理，后期如果需要做协议层性能上的优化，那只需要优化Tether的性能就可以了。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="关于TWA"><a href="#关于TWA" class="headerlink" title="关于TWA"></a>关于TWA</h3><p>TWA是蚂蚁金服自研的，整合了BFF的一整套渐进式的前端+Node聚合层的开发体系，它不仅包括了BFF的引入，还包括了前后端代码管理、部署、运维等功能框架。</p>
<p>但是很遗憾的是，TWA没有开源，对于想要从0开始引入BFF，想实现TWA的功能，还有一个努力的过程。</p>
<p>实际上我们引入BFF，不是要完整的开发TWA，而是首先实现Chari BFF的功能。</p>
<h3 id="接入BFF的好处"><a href="#接入BFF的好处" class="headerlink" title="接入BFF的好处"></a>接入BFF的好处</h3><p>对于团队来说：</p>
<ul>
<li>业务支持变多</li>
<li>沟通协作变少</li>
<li>解决问题变快</li>
</ul>
<p>对于个人来说：</p>
<ul>
<li>更合理分工</li>
<li>做BFF可以拓展知识面</li>
</ul>
<h3 id="接入BFF的坏处："><a href="#接入BFF的坏处：" class="headerlink" title="接入BFF的坏处："></a>接入BFF的坏处：</h3><ul>
<li>组织决定了架构的复杂度</li>
<li>前期学习成本高，短期成为资源瓶颈</li>
</ul>
<h3 id="可能遇到的问题和可能的解决方法"><a href="#可能遇到的问题和可能的解决方法" class="headerlink" title="可能遇到的问题和可能的解决方法"></a>可能遇到的问题和可能的解决方法</h3><ol>
<li>Node与Java通信 – Hessian（数据），RPC（服务）（<a target="_blank" rel="noopener" href="https://github.com/alipay/sofa-rpc-node/">sofa-rpc-node</a>）&#x2F; （<a target="_blank" rel="noopener" href="https://github.com/grpc/grpc-node">grpc-node</a>）</li>
<li>前端代码和BFF段代码管理 – Egg.js（同一个仓库，不同目录，不同依赖，分别打包、分别配置）</li>
<li>前端的应用发布、运维能力 – Docker</li>
<li>服务端的配合 – 服务：微服务（？），人员： （？）</li>
<li>前端能力提高 – 前端能力（JavaScript + HTML + CSS) + Node（服务端技能）+ Java（如何与Java通信）+ 运维能力（Docker）</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://samnewman.io/patterns/architectural/bff/">Pattern: Backends For Frontends@samnewman</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/264563447">为什么互联网公司开始用node.js做web服务的中间件？有什么好处吗？@知乎</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ayqy.net/blog/backend-for-frontend-bff/">Backend For Frontend@黯羽轻扬</a></li>
<li><a target="_blank" rel="noopener" href="https://os.alipayobjects.com/rmsportal/WtUmBLJSmqtDHkvJzuzM.pdf">蚂蚁财富的BFF实践.pdf@alipayobjects</a></li>
<li><a target="_blank" rel="noopener" href="http://www.10tiao.com/html/681/201806/2651029903/1.html">微服务架构：BFF和网关是如何演化出来的@10条</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/32219319">Developer Experience First —— TWA 的理念与实践@知乎专栏</a></li>
<li><a target="_blank" rel="noopener" href="https://v.youku.com/v_show/id_XMzMwMzc2NDg0OA==.html">Techless Web Application 的理念与实践 — 不四@优酷</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/office/yuque/2018/pdf/546dea6e-66dd-4cf5-98fb-7c2476ea4986.pdf">02_SEEConf_TWA的理念与实践_不四.pdf@语雀</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5b0388006fb9a07aa213ae16">Node 在有赞的实践@掘金</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/egg/nodejs/dklip5">聊聊 Node.js RPC（一）— 协议@语雀</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/egg/nodejs/mhgl9f">聊聊 Node.js RPC（二）— 服务发现@语雀</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/BFF/" rel="tag"># BFF</a>
              <a href="/tags/TWA/" rel="tag"># TWA</a>
              <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"># 微服务</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/04/15/05%20%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91/03%20Egg/Egg01%20%E5%85%A5%E9%97%A8/" rel="prev" title="Egg01 入门">
                  <i class="fa fa-chevron-left"></i> Egg01 入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/04/27/01%20%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/07%20%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%98/%E9%9B%B6%E6%95%A3%E4%B8%93%E9%A2%9828%20BFF%E8%B0%83%E7%A0%942/" rel="next" title="零散专题28 BFF调研2">
                  零散专题28 BFF调研2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">多啦大薯片</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  




  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"duola8789/duola8789.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
